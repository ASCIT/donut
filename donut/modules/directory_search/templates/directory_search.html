{% extends 'layout.html' %}
{% block page %}
	<div class='col-md-6 col-md-offset-3' style='float: none; padding-bottom: 25px'>
		<h1>Directory Search</h1>
		<h4>I'm looking for someone...</h4>
		<form>
			<div class='form-group'>
				<label for='name'>Named</label>
				<input class='form-control' id='name' name='name' placeholder='Name' />
				<ul class='list-group' id='name-search'></ul>
			</div>
		</form>
	</div>
{% endblock %}
{% block scripts %}
	{{ super() }}
	<script>
		var MIN_SEARCH_LENGTH = 3
		var SEARCH_TIMEOUT = 300 //ms
		var searchToken

		$(document).ready(function() {
			var nameInput = $('input#name'), nameSearch = $('ul#name-search')
			nameInput.keyup(function() {
				var name = nameInput.val()
				if (name.length < MIN_SEARCH_LENGTH) return
				var token = {}
				searchToken = token
				setTimeout(function() {
					if (searchToken !== token) return //newer request issued
					$.ajax({
						url: '/1/users/search/' + encodeURIComponent(name),
						dataType: 'json',
						success: function(users) {
							if (searchToken !== token) return //newer request issued
							nameSearch.children().remove()
							for (var i = 0; i < users.length; i++) {
								var user = users[i]
								nameSearch.append(
									$('<li>').addClass('list-group-item').append(
										$('<a>').attr('href', '/1/users/' + String(user.user_id)).text(user.full_name)
									)
								)
							}
							if (!users.length) nameSearch.append($('<li>').addClass('list-group-item').text('No users found'))
						}
					})
				}, SEARCH_TIMEOUT)
			})
		})
	</script>
{% endblock %}
