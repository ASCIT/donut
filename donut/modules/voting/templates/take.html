{% extends 'layout.html' %}
{% block page %}
<div class="container theme-showcase">
	<div class="jumbotron">
		<h1>
			<strong>{{ title }}</strong>
		</h1>
		{% if description %}
			<h2>{{ description }}</h2>
		{% endif %}
		<form url="{{ url_for('voting.submit', access_key=access_key) }}" method="POST">
			{% if auth %}
				<h4>Please enter your UID and birthday to verify your identity</h4>
				<div class="form-group">
					<label for="uid">UID</label>
					<input class="form-control" id="uid" name="uid" placeholder="1234567" autofocus />
				</div>
				<div class="form-group">
					<label for="birthday">Birthday</label>
					<input type="date" class="form-control" id="birthday" name="birthday"/>
				</div>
			{% endif %}
			<ul id="question_container"></ul>
		</form>
	</div>
</div>
{% endblock %}
{% block styles %}
	{{ super() }}
	<link rel="stylesheet" href="{{ url_for('static', filename='css/voting-forms.css') }}" />
	<style>
		.left {
			text-align: left;
		}
	</style>
{% endblock %}
{% block scripts %}
	{{ super() }}
	<script>
		var QUESTION_TYPES = {{ question_types|safe }}
		var questionData = {{ questions_json|safe }}

		$(document).ready(function() {
			var questionContainer = $('#question_container')
			questionData.forEach(function(question, index) {
				var elementInner = $('<div>').addClass('left').append(
					$('<h3>').text(
						String(index + 1) + '. ' + question.title
					)
				)
				if (question.description) elementInner.append($('<h4>').text(question.description))
				var li = $('<li>').addClass('element').append(elementInner)
				switch (question.type) {
					case QUESTION_TYPES.Dropdown:
						var select = $('<select>').addClass('form-control choices')
						question.choices.forEach(function(choice) {
							select.append($('<option>').text(choice))
						})
						elementInner.append(select)
						break
					case QUESTION_TYPES['Elected position']:
						//TODO
						break
					case QUESTION_TYPES.Checkboxes:
						var choicesDiv = $('<div>').addClass('choices')
						question.choices.forEach(function(choice) {
							choicesDiv.append($('<div>').append(
								$('<label>').text(choice).append(
									$('<input>').attr('type', 'checkbox')
								)
							))
						})
						elementInner.append(choicesDiv)
						break
					case QUESTION_TYPES['Short text']:
						elementInner.append($('<input>').addClass('form-control'))
						break
					case QUESTION_TYPES['Long text']:
						elementInner.append($('<textarea>').addClass('form-control'))
				}
				questionContainer.append(li)
			})
		})
	</script>
{% endblock %}
